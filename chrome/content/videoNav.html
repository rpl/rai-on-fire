<html>
  <head>
    <title>Video Navigation</title>
    <link rel="stylesheet" type="text/css" href="videoNav.css"></link>
    <script src="jquery-1.3.2.js"></script>
    <script src="pure.js"></script>
    <script>
      TEST = {
        generationDate: "2009-12-18 00:15:44",
        channels: [
          { name: "Rai Uno", videos: [{name: "diretta", url: "test1"}] }
        ]
      }

      var directive = {
        "li.channel": {
           "channel<-channels": {
              "h2.channel_name": "channel.name",
	      "li.video": {
                 "video<-channel.videos": {
		   "a.video_name": "video.name",
                   "a.video_url@onclick": "openInVideoTab('#{video.url}');"
                 }
              }
	   }
        }
      }

      function url(spec) {
        var ios = Components.classes["@mozilla.org/network/io-service;1"].getService(Components.interfaces.nsIIOService);
        return ios.newURI(spec, null, null);
      }

      function openInVideoTab(videourl) {
        var activeWin = Application.activeWindow;
        var videotab = activeWin.open(url(videourl));
        videotab.focus();
      }

      $(function() { 
         window.addEventListener("message", receiveMessage, false);

         function receiveMessage(event)
         {
             $("div#videoRoot").render(JSON.parse(event.data),directive);
	     $(".videos").hide();
             $("h2").click(function() {
               $(this).next().slideToggle("fast");
             });
         }

      });
    </script>
  </head>
  <body>
    <div id="videoRoot">
      <ul class="channels">
        <li class="channel">
	  <h2 class="channel_name">RAI on Fire</h2>
	  <ul class="videos">
	    <li class="video">
	      <a class="video_name video_url">scarica la lista dei programmi premendo il tasto <b>Download</b></a>
	    </li>
	  <ul>
	</li>
      <ul>
    </div>
  </body>
</html>
